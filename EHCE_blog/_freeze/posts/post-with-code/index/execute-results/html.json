{
  "hash": "707348e9a95d102f376147cc3b314254",
  "result": {
    "markdown": "---\ntitle: \"EHCE Intensity Trend Analysis\"\nauthor: \"Jingya Cheng\"\ndate: \"2024-01-04\"\ncategories: [code, analysis, trend]\n---\n\n\n# Extreme Heat/Cold Events Intensity Trend Analysis\n\n\n\n\n\n### Loading the base spatail data set including Counties and States boundaires\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource_dir <- \"./data/\"\nstates_file_path <- file.path(source_dir,\n                              \"us49_states_geo_tigris.rds\")\nstates_geo <- readRDS(states_file_path)[[1]]\ncounties_file_path <- file.path(source_dir,\n                                \"us49_counties_geo_tigris.rds\")\ncounties_geo <- readRDS(counties_file_path)[[1]]\n```\n:::\n\n\n### Loading the aggregate extreme events data set\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_path <- file.path(source_dir,\n                      \"Counties_compiled_admin_geo_ehe_ece_sf_2008_2022.rds\")\nfile_size <- file.info(dat_path)$size\ndat <- readRDS(dat_path)[[1]]\n```\n:::\n\n\n### Calculating the average intensity with complete yearly intensity records\n\n#### Overall intensity\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat_table = dat %>%  st_drop_geometry()\n## Adding years with no event to the dataset \nlookup_table <- dat_table %>%\n  select(GEOID, NAME, STUSPS, STATE_NAME) %>%\n  distinct() %>%\n  filter(!is.na(NAME) & !is.na(STUSPS) & !is.na(STATE_NAME))\n\nfill_na_with_lookup <- function(dat_table, lookup_table, column) {\n  na_rows <- is.na(dat_table[[column]])\n  lookup_values <- lookup_table[match(dat_table$GEOID[na_rows], lookup_table$GEOID), column]\n  dat_table[[column]][na_rows] <- lookup_values\n  return(dat_table)\n}\nyear_range <- data.frame(year_numerical = 2008:2022)\nunique_geoids <- unique(dat$GEOID)\nyear_geoid_combinations <- expand.grid(year_numerical = year_range$year_numerical, GEOID = unique_geoids)\n\n## Overall\ndat_table$abs_intensity = abs(dat_table$avg_intensity)\n\ncounty_yearly_intensity <- dat_table %>%\n  group_by(GEOID,NAME, STATE_NAME, year_numerical) %>%\n  summarize(mean_intensity = mean(abs_intensity))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'GEOID', 'NAME', 'STATE_NAME'. You can\noverride using the `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\ndat_intensity_all <- merge(year_geoid_combinations, county_yearly_intensity, by = c(\"year_numerical\", \"GEOID\"), all = TRUE)\ndat_intensity_all[\"mean_intensity\"] <- lapply(dat_intensity_all[\"mean_intensity\"], function(x) ifelse(is.na(x), 0, x))\ndat_intensity_all <- fill_na_with_lookup(dat_intensity_all, \n                                               lookup_table, \"NAME\")\ndat_intensity_all <- fill_na_with_lookup(dat_intensity_all, \n                                               lookup_table, \"STATE_NAME\")\n\n#linear regression and calcualte percentage change\nlm_intensity_all <- dat_intensity_all %>%\n  group_by(GEOID, NAME, STATE_NAME) %>%\n  do(model = lm(mean_intensity ~ year_numerical, data = .))\n\nslopes_all <- lm_intensity_all %>%\n  rowwise() %>%\n  mutate(slope = coef(model)[[\"year_numerical\"]],\n         p_value = summary(model)$coefficients[\"year_numerical\",\"Pr(>|t|)\"])\n```\n:::\n\n\n#### Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslopes_cut = slopes_all %>% filter(p_value < 0.05)\n# Merge with geometry data\ncounty_boundaris_catalog_all <- merge(counties_geo,\n          slopes_cut %>% st_drop_geometry(),\n          by.x=\"GEOID\",\n          by.y=\"GEOID\",\n          all.x = TRUE,\n          all.y = TRUE,\n          suffix = c(\"\",\"_sp\")) %>% st_as_sf() \n# Intensity all map\nggplot() +\n  geom_sf(data = county_boundaris_catalog_all,\n            aes(fill = slope),\n            lwd = .1) + \n  scale_fill_distiller(palette = \"RdBu\", \n                       limit = c(-3, 3),breaks = c(-3, 0, 3)\n                       ) +\n  geom_sf(data = states_geo, fill = NA, color = \"black\", size = 0.5) +\n  labs(fill = \"Intensity\") +\n  theme_void() + \n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n#### Extreme Heat Events\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_heat_intensity <- dat_table %>%\n  filter(event_type == \"Extreme Heat Event\") %>%\n  group_by(GEOID,NAME, STATE_NAME, year_numerical) %>%\n  summarize(mean_intensity = mean(abs_intensity))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'GEOID', 'NAME', 'STATE_NAME'. You can\noverride using the `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\ndat_intensity_ehe <- merge(year_geoid_combinations, county_heat_intensity, by = c(\"year_numerical\", \"GEOID\"), all = TRUE)\ndat_intensity_ehe[\"mean_intensity\"] <- lapply(dat_intensity_ehe[\"mean_intensity\"], function(x) ifelse(is.na(x), 0, x))\n\ndat_intensity_ehe <- fill_na_with_lookup(dat_intensity_ehe, lookup_table, \"NAME\")\ndat_intensity_ehe <- fill_na_with_lookup(dat_intensity_ehe, lookup_table, \"STATE_NAME\")\n\n## Standardized linear regression\nlm_intensity_ehe <- dat_intensity_ehe %>%\n  group_by(GEOID, NAME, STATE_NAME) %>%\n  do(model = lm(mean_intensity ~ year_numerical, data = .))\n\nslopes_ehe <- lm_intensity_ehe %>%\n  rowwise() %>%\n  mutate(slope = coef(model)[[\"year_numerical\"]],\n         p_value = summary(model)$coefficients[\"year_numerical\",\"Pr(>|t|)\"])\n```\n:::\n\n\n#### Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslopes_ehe_cut = slopes_ehe %>% filter(p_value < 0.05)\n# Merge with geometry data\ncounty_boundaris_ehe_catalog <- merge(counties_geo,\n          slopes_ehe_cut %>% st_drop_geometry(),\n          by.x=\"GEOID\",\n          by.y=\"GEOID\",\n          all.x = TRUE,\n          all.y = TRUE,\n          suffix = c(\"\",\"_sp\")) %>% st_as_sf() \n# Intensity EHE map\nggplot() +\n  geom_sf(data = county_boundaris_ehe_catalog,\n            aes(fill = slope),\n            lwd = .1) + \n  scale_fill_distiller(palette = \"RdBu\", limit = c(-3, 3),\n                       breaks = c(-3,  0, 3)) +\n  geom_sf(data = states_geo, fill = NA, color = \"black\", size = 0.5) +\n  labs(fill = \"Intensity EHE\") +\n  theme_void() + \n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n#### Extreme Cold Events\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounty_cold_intensity <- dat_table %>%\n  filter(event_type == \"Extreme Cold Event\") %>%\n  group_by(GEOID,NAME, STATE_NAME, year_numerical) %>%\n  summarize(mean_intensity = mean(abs_intensity))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'GEOID', 'NAME', 'STATE_NAME'. You can\noverride using the `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\ndat_intensity_ece <- merge(year_geoid_combinations, county_cold_intensity, by = c(\"year_numerical\", \"GEOID\"), all = TRUE)\ndat_intensity_ece[\"mean_intensity\"] <- lapply(dat_intensity_ece[\"mean_intensity\"], function(x) ifelse(is.na(x), 0, x))\n\ndat_intensity_ece <- fill_na_with_lookup(dat_intensity_ece, lookup_table, \"NAME\")\ndat_intensity_ece <- fill_na_with_lookup(dat_intensity_ece, lookup_table, \"STATE_NAME\")\n\nlm_intensity_ece <- dat_intensity_ece %>%\n  group_by(GEOID, NAME, STATE_NAME) %>%\n  do(model = lm(mean_intensity ~ year_numerical, data = .))\n\nslopes_ece <- lm_intensity_ece %>%\n  rowwise() %>%\n  mutate(slope = coef(model)[[\"year_numerical\"]],\n         p_value = summary(model)$coefficients[\"year_numerical\",\"Pr(>|t|)\"])\n```\n:::\n\n\n#### Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslopes_ece_cut = slopes_ece %>% filter(p_value < 0.05)\n# Merge with geometry data\ncounty_boundaris_ece_catalog <- merge(counties_geo,\n          slopes_ece_cut %>% st_drop_geometry(),\n          by.x=\"GEOID\",\n          by.y=\"GEOID\",\n          all.x = TRUE,\n          all.y = TRUE,\n          suffix = c(\"\",\"_sp\")) %>% st_as_sf() \n# Intensity ECE map\nggplot() +\n  geom_sf(data = county_boundaris_ece_catalog,\n            aes(fill = slope),\n            lwd = .1) + \n  scale_fill_distiller(palette = \"RdBu\", limit = c(-4, 4),\n                       breaks = c(-4, 0, 4)) +\n  geom_sf(data = states_geo, fill = NA, color = \"black\", size = 0.5) +\n  labs(fill = \"Intensity ECE\") +\n  theme_void() + \n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}